# =========================
# 全局 Nginx 配置
# =========================
user  nginx;                       # nginx 进程用户
worker_processes auto;             # 自动使用 CPU 核心数
error_log  /var/log/nginx/error.log warn;  # 错误日志路径及级别
pid        /var/run/nginx.pid;     # PID 文件路径

events {
    worker_connections 1024;       # 每个 worker 最大连接数
}

http {
    include       /etc/nginx/mime.types;  # 常用 MIME 类型
    default_type  application/octet-stream; # 默认 MIME 类型

    sendfile        on;             # 高效发送文件
    tcp_nopush      on;             # 减少 TCP 包数量
    tcp_nodelay     on;             # 避免延迟发送小数据包
    keepalive_timeout 65;           # 长连接超时时间
    types_hash_max_size 2048;       # types hash 表大小
    gzip on;                         # 开启 gzip 压缩

    # ====================================================
    # Blog 项目缓存定义
    # ====================================================
    proxy_cache_path /var/cache/nginx/blog    # 磁盘实际存储路径
        levels=1:2                            # 磁盘子目录层级，避免文件过多
        keys_zone=blog_cache:100m            # 内存缓存区名称和大小（元信息存储）
        max_size=3g                          # 磁盘占用上限
        inactive=365d                         # N 天没访问就删除缓存
        use_temp_path=off;                     # 不使用临时目录，直接写磁盘，提高性能

    # ====================================================
    # Forum 项目缓存定义（可选）
    # ====================================================
    proxy_cache_path /var/cache/nginx/forum
        levels=1:2
        keys_zone=forum_cache:100m
        max_size=20g
        inactive=365d
        use_temp_path=off;

    # ====================================================
    # 引入各 server 配置
    # ====================================================
    include /etc/nginx/conf.d/*.conf;   # 包含 conf.d 文件夹下所有 server 配置
}
